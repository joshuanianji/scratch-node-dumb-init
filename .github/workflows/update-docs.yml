name: Update Docs

on:
  workflow_dispatch:
  pull_request:
    paths:
      - '.github/workflows/update-docs.yml' # this file
      - 'scripts/*'

env:
  TEST_TAG: ${{ github.repository }}/test
  REGISTRY: ghcr.io

jobs:
  build-and-load:
    name: Download All Images
    runs-on: ubuntu-latest
    strategy:
      matrix:
        node-version: [8.17.0, 10.22.0, 12.22.1, 14.17.0, 16.14.2, 18.10.0]
    steps:
      - name: 🏁 Checkout repo
        uses: actions/checkout@v3

      - name: 🐳 Set up Docker Buildx
        id: buildx
        uses: docker/setup-buildx-action@v2.5.0

      # https://docs.docker.com/build/ci/github-actions/test-before-push/
      # this first build just caches the layers
      - name: 🏗️ Build
        uses: docker/build-push-action@v4
        with:
          build-args: |
            NODE_VERSION=${{ matrix.node-version }}
          outputs: type=docker,dest=/tmp/image-${{ matrix.node-version }}.tar

      - name: 📦 Upload Artifact
        uses: actions/upload-artifact@v3
        with:
          name: image-${{ matrix.node-version }}
          path: /tmp/image-${{ matrix.node-version }}.tar

  update-docs:
    runs-on: ubuntu-latest
    needs: build-and-load
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      # - name: Run Script
      #   uses: actions/github-script@v6
      #   id: script
      #   with:
      #     result-encoding: string
      #     script: |
      #       const script = require('./scripts/update-versions.js')
      #       await script({ github, context, core })
      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v2

      # download to working directory
      - name: Download all artifacts
        uses: actions/download-artifact@v3

      - name: check directory
        run: ls -R

      # - name: Load images
      #   run: |
      #     docker load --input /tmp/myimage.tar
      #     docker image ls -a
